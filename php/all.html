<h2>php.ini</h2>
<pre class="prettyprint lang-apache">
upload_max_filesize = 10M
max_file_uploads = 20
post_max_size = 210M
</pre>
<pre class="prettyprint lang-sh">sudo service apache2 restart</pre>
<h2>Функции</h2>
<h3>iconv - изменение кодировки строки</h3>
<pre class="prettyprint lang-php">
$s = 'Р’РёРЅРёР»РѕРІР°СЏ Р°РїРїР»РёРєР°С†РёСЏ РІ РЅРѕС‡РЅРѕРј РєР»СѓР±Рµ - С„Р»СЋРѕСЂ';
$s = iconv('utf8', 'cp1251', $s);
echo &quot;&lt;pre&gt;&quot;;
var_dump($s);
echo &quot;&lt;/pre&gt;&quot;;

$s = 'Виниловая аппликация в ночном клубе - флюор';
$s = iconv('cp1251', 'utf8', $s);
echo &quot;&lt;pre&gt;&quot;;
var_dump($s);
echo &quot;&lt;/pre&gt;&quot;;
</pre>
<h2>Константы</h2>
<pre class="prettyprint lang-php">if (!defined('COOKIE_ENABLED')) {
    define('COOKIE_ENABLED', false);
}</pre>
<h2>PHP in console</h2>
<pre class="prettyprint lang-php">
php -r 'echo &quot;Hello&quot; . &quot; world&quot;;'
</pre>
<h2>Наработки</h2>
<h3>Загрузка файла на сервер</h3>
<pre class="prettyprint lang-php">$ext = pathinfo($_FILES['name'], PATHINFO_EXTENSION); // Расширение файла</pre>
<h3>IP адрес пользователя</h3>
<p><code>$_SERVER['REMOTE_ADDR']</code>, остальное - фуфло. Все что начинается с <code>$_SERVER['HTML_...</code> - это заголовки, их можно подделать!</p>
<h3>Фильтрация данных пользователя</h3>
<p><strong>Коротко список используемых функций:</strong></p>
<ul>
    <li><a href="http://php.net/manual/ru/function.intval.php">intval</a></li>
    <li><a href="http://php.net/manual/ru/function.strip-tags.php">strip_tags</a></li>
    <li><a href="http://php.net/manual/ru/function.htmlspecialchars.php">htmlspecialchars</a></li>
</ul>
<h4>Интеджер</h4>
<pre class="prettyprint lang-php">$number = intval($_GET['input_number']);
if ($number)
{
... выполняем SQL запрос ...
}</pre>
<h4>Стринг</h4>
<p>Не предполагаем вхождение html тегов:</p>
<pre class="prettyprint lang-php">$input_text = strip_tags($_GET['input_text']);
$input_text = htmlspecialchars($input_text);
$input_text = mysql_escape_string($input_text);
</pre>
<p>Если сразу массив данных</p>
<pre class="prettyprint lang-php">$checkbox_arr = array_map('intval', $_POST['checkbox']);</pre>
<h3>"Запрет" повторной отправки формы по F5</h3>
<pre class="prettyprint lang-php">header('Location: index.php');</pre>
<p>или проще:</p>
<pre class="prettyprint lang-php">header('Refresh:0');</pre>
<h2>Cookie</h2>
<h3>Установка и чтение cookie</h3>
<pre class="prettyprint lang-php">setcookie("voting", $cookieVoting, time()+60*60*24*7, "/");
if ( isset($_COOKIE) &amp;&amp; isset($_COOKIE['voting']) ) {
	$cookieVoting = $_COOKIE['voting'];</pre>
<h3>Удаление cookie</h3>
<p><code>unset($_COOKIE['voting'])</code> - удаляет переменную на сервере (
    <mark>не удаляет из браузера!</mark>)</p>
<p>Удалить из браузера пользователя:</p>
<pre class="prettyprint lang-php">setcookie("voting", null, time()-60*60*24*7, "/");</pre>
<h3>Проверка включены ли куки в браузере</h3>
<pre class="prettyprint lang-php">&lt;?php
// Recommended way for versions of PHP &gt;= 5.4.0
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}
//For versions of PHP &lt; 5.4.0
// if(session_id() == '') {
//     session_start();
// }


// Если нет проверочного гет запроса,
// но нет флага от второго прохождения прохождения
// то запекаем печенье ()
// скармливаем браузеру (пересылаем header()-ом с проверочным гет запросом)
if ( !isset($_GET['checkCookie']) &amp;&amp; !isset($_SESSION['cookieIsChecked']) ) {
    // сохраняем ссылку в сессию, если печеньки работаю, то мы сможем восстановить ссылку позже
    $_SESSION['QUERY_STRING'] = $_SERVER['QUERY_STRING'];
    // запекаем
    setcookie('foo', 'bar', time() + 60*60*24);
    // redirecting to the same page to check 
    if (empty($_SERVER['QUERY_STRING'])) {
	    header(&quot;location: {$_SERVER['PHP_SELF']}?checkCookie=true&quot;);
    } else {
	    header(&quot;location: {$_SERVER['PHP_SELF']}?{$_SESSION['QUERY_STRING']}&amp;checkCookie=true&quot;);
    }
}

// Если есть проверочный гет,
// и нет флага второго прохождения
// проверяем печеньки съедины или нет
// если печеньки работают, то восстанавливаем исходный урл методом header()-а (перед этим установив флаг второго прохождения)
// если печеньки не работаю
if ( isset($_GET['checkCookie']) &amp;&amp; ($_GET['checkCookie'] == true) &amp;&amp; !isset($_SESSION['cookieIsChecked']) ) {
    if (isset($_COOKIE['foo']) &amp;&amp; $_COOKIE['foo'] == 'bar') {
    	setcookie('foo', 'bar', time() - 60*60*24);
        $_SESSION['cookieIsChecked'] = true;
        if (!isset($_SESSION['QUERY_STRING']) || empty($_SESSION['QUERY_STRING'])) {
    		header(&quot;location: {$_SERVER['PHP_SELF']}&quot;);
        } else {
    		header(&quot;location: {$_SERVER['PHP_SELF']}?{$_SESSION['QUERY_STRING']}&quot;);
        }
    } else {
    }
}

if (isset($_SESSION['cookieIsChecked']) &amp;&amp; $_SESSION['cookieIsChecked'] === true) {
	define('COOKIE_ENABLED', true);
}
if (!defined('COOKIE_ENABLED')) {
    define('COOKIE_ENABLED', false);
}
</pre>
<h2>Комментирование</h2>
<pre class="prettyprint lang-php">&lt;!-- html  --&gt;&lt;?php // echo 'asd'; ?&gt;&lt;!--  html --&gt;
&lt;!-- html  --&gt;&lt;?php //= 'asd'; ?&gt;&lt;!--  html --&gt;</pre>
