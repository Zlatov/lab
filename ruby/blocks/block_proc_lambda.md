# block Proc lambda

### üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤, Proc –∏ lambda

| –ß—Ç–æ                   | –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é? | –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç?    | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–µ—Ç–æ–¥–∞—Ö            | –•–∞—Ä–∞–∫—Ç–µ—Ä –ø–æ–≤–µ–¥–µ–Ω–∏—è              |
| --------------------- | ----------------------------- | ------------------------------- | ---------------------------------- | ------------------------------- |
| **–ë–ª–æ–∫** (`do...end`) | ‚ùå –ù–µ—Ç                         | ‚ùå –¢–æ–ª—å–∫–æ –Ω–µ—è–≤–Ω–æ –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–ø—Ä–∏–ª–∏–ø–∞–µ—Ç" –∫ –º–µ—Ç–æ–¥—É | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä |
| **Proc.new**          | ‚úÖ –î–∞                          | ‚úÖ –î–∞                            | –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è —è–≤–Ω–æ                    | –ì–∏–±–∫–∞—è, —Å–≤–æ–±–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è       |
| **lambda** / `->`     | ‚úÖ –î–∞                          | ‚úÖ –î–∞                            | –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è —è–≤–Ω–æ                    | –ö–∞–∫ `Proc`, –Ω–æ —Å—Ç—Ä–æ–≥–∞—è          |


#### üóù –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

* **–ë–ª–æ–∫** ‚Äî –∫–∞–∫ "–Ω–µ–≤–∏–¥–∏–º—ã–π –ø–∞—Å—Å–∞–∂–∏—Ä", –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω**, –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —è–≤–Ω–æ, –Ω–æ –º–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –µ–≥–æ –ø—Ä–∏–Ω—è—Ç—å —á–µ—Ä–µ–∑ `yield` –∏–ª–∏ `&block`.

* **Proc** –∏ **lambda** ‚Äî –∫–∞–∫ "–ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã", –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ:

  * —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å,
  * –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å,
  * –≤—ã–∑—ã–≤–∞—Ç—å –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ (`.call` / `.() / .yield`),
  * –≤–µ—Å—Ç–∏ —Å–µ–±—è –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.


### üìå –û–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ return

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å                         | –ë–ª–æ–∫              | `Proc.new`            | `lambda` (`->`)       |
| ----------------------------------- | ----------------- | --------------------- | --------------------- |
| –í–∏–¥–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | ‚úÖ –î–∞              | ‚úÖ –î–∞                  | ‚úÖ –î–∞                  |
| –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –≤–Ω–µ—à–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ   | ‚úÖ –î–∞              | ‚úÖ –î–∞                  | ‚úÖ –î–∞                  |
| –°–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É–∂—É           | ‚ùå –ù–µ—Ç               | ‚ùå –ù–µ—Ç               | ‚ùå –ù–µ—Ç                     |
| `return` –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Ä–æ–¥–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞  | ‚úÖ –î–∞ (–æ–ø–∞—Å–Ω–æ!)    | ‚úÖ –î–∞ (–æ–ø–∞—Å–Ω–æ!)        | ‚ùå –ù–µ—Ç (—Ç–æ–ª—å–∫–æ –∏–∑ –Ω–µ—ë) |
| `next`, `break`                     | –†–∞–±–æ—Ç–∞—é—Ç –≤ –º–µ—Ç–æ–¥–µ | –†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ `return` | –†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –≤ –±–ª–æ–∫–µ  |


### üß™ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

| –ü–æ–≤–µ–¥–µ–Ω–∏–µ             | –ë–ª–æ–∫  | `Proc.new` | `lambda` (`->`)                       |
| --------------------- | ----- | ---------- | ------------------------------------- |
| –ê—Ä–≥—É–º–µ–Ω—Ç—ã —Å—Ç—Ä–æ–≥–∏–µ     | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç      | ‚úÖ –î–∞                                  |
| –ê—Ä–≥—É–º–µ–Ω—Ç—ã "—Å—ä–µ–¥–∞—é—Ç—Å—è" | ‚úÖ –î–∞  | ‚úÖ –î–∞       | ‚ùå –ù–µ—Ç (–æ—à–∏–±–∫–∞ –ø—Ä–∏ –ª–∏—à–Ω–∏—Ö/–Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö) |


### üß± –û–±—ä–µ–∫—Ç—ã –∏ —Ç–∏–ø—ã

| –°–∏–Ω—Ç–∞–∫—Å–∏—Å     | –¢–∏–ø    | –ö–ª–∞—Å—Å | `lambda?` |
| ------------- | ------ | ----- | --------- |
| `-> {}`       | –ª—è–º–±–¥–∞ | Proc  | `true`    |
| `lambda {}`   | –ª—è–º–±–¥–∞ | Proc  | `true`    |
| `Proc.new {}` | "–ø—Ä–æ–∫" | Proc  | `false`   |
| –±–ª–æ–∫ `{}`     | –±–ª–æ–∫   | ‚Äî     | ‚Äî         |

‚úÖ –í—Å—ë, —á—Ç–æ `->`, `lambda`, `Proc.new` ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç—ã `Proc`. –ù–æ `lambda?` –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∏—á–∏—Ç—å ¬´—Å—Ç—Ä–æ–≥—É—é¬ª –ª—è–º–±–¥—É –æ—Ç ¬´–≤–æ–ª—å–Ω–æ–≥–æ¬ª –ø—Ä–æ–∫–∞.


### üîç –ó–Ω–∞—á–µ–Ω–∏–µ `self` –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞, Proc –∏ lambda

| –ö–æ–Ω—Ç–µ–∫—Å—Ç        | –ß—Ç–æ —Ç–∞–∫–æ–µ `self` –≤–Ω—É—Ç—Ä–∏?                  | –ü—Ä–∏–º–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                             |
| --------------- | ----------------------------------------- | ---------------------------------------------- |
| **–ë–ª–æ–∫**        | –ù–∞—Å–ª–µ–¥—É–µ—Ç `self` –∏–∑ –º–µ—Å—Ç–∞ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞   | –¢–∏–ø–∏—á–Ω–æ ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã–∑–≤–∞–ª–∏ –º–µ—Ç–æ–¥ |
| **Proc.new**    | –ù–∞—Å–ª–µ–¥—É–µ—Ç `self` –∏–∑ –º–µ—Å—Ç–∞ **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** | –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Ö–æ–∂–µ —Å –±–ª–æ–∫–æ–º                       |
| **lambda / ->** | –ù–∞—Å–ª–µ–¥—É–µ—Ç `self` –∏–∑ –º–µ—Å—Ç–∞ **–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** | –¢–æ –∂–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —á—Ç–æ –∏ —É `Proc.new`            |

```rb
class Example
  # üõ†Ô∏è Proc —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–ª–∞—Å—Å–∞
  # –ü–æ—ç—Ç–æ–º—É —Ç—É—Ç Proc –ø—Ä–∏–æ–±—Ä–µ—Ç–∞–µ—Ç self = Example
  PROC_FROM_CLASS = Proc.new do
    puts "PROC self: #{self.inspect}"
  end

  def show_with_block
    # üõ†Ô∏è –ë–ª–æ–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (–≤ –º–µ—Å—Ç–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ —Å –±–ª–æ–∫–æ–º)
    # üöÄ –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —Å –±–ª–æ–∫–æ–º
    # –ü–æ—ç—Ç–æ–º—É —Ç—É—Ç –±–ª–æ–∫ –ø—Ä–∏–æ–±—Ä–µ—Ç–∞–µ—Ç self = #<Example‚Ä¶>
    method_with_block do
      puts "BLOCK self: #{self.inspect}"
    end
  end

  def show_with_proc
    # üöÄ –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ —Å Proc
    method_with_proc(PROC_FROM_CLASS)
  end

  private

  def method_with_block(&block)
    block.call
  end

  def method_with_proc(proc)
    proc.call
  end
end

ex = Example.new
ex.show_with_block
#> BLOCK self: #<Example‚Ä¶>
ex.show_with_proc
#> PROC self: Example
```

–ö–∞–∫ –Ω–∞—Å –æ–±–º–∞–Ω—ã–≤–∞—é—Ç:

```rb
class Order
  # –ú—ã –≤–∏–¥–∏–º –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –∫–ª–∞—Å—Å–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –±–ª–æ–∫–∞ - –æ–∂–∏–¥–∞–µ–º –≤ –±–ª–æ–∫–µ self = Order.
  # –ù–æ self == #<Order> –ø–æ—Ç–æ–º—É,
  # —á—Ç–æ –º–µ—Ç–æ–¥ ActiveModel::Validations::ClassMethods#validate
  # 1. –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –±–ª–æ–∫ –≤ Proc;
  # 2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º –æ–±—ä–µ–∫—Ç–µ;
  # 3. –ü—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç .call(order) –º–µ–Ω—è—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞.
  validate on: :create do
    if user_id.blank?
      errors.add(:user_id, '–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º')
    end
  end
end
```

## –ö—Ä–∞—Å–Ω–∞—è —Ç–∞–±–ª–µ—Ç–∫–∞ lambda->–ë–ª–æ–∫->Proc

üìò –•–æ—á–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å lambda, –Ω–æ –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±–ª–æ–∫?

```rb
class Order
  # `&->(order)` ‚Äî —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Ç—Ä—é–∫:
  # 1. `->(order) { ... }` —Å–æ–∑–¥–∞—ë—Ç lambda (–æ—Å–æ–±—ã–π Proc —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º return).
  # 2. `&` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –µ—ë –≤ –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π Rails –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ –º–µ—Ç–æ–¥ `validate`.
  #
  # Rails –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –±–ª–æ–∫ –æ–±—Ä–∞—Ç–Ω–æ –≤ Proc ‚Äî –ù–û:
  # ‚ùóÔ∏è –≠—Ç–æ—Ç Proc —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `lambda? == true`, –∑–Ω–∞—á–∏—Ç `return` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ.
  #
  # –í –º–æ–º–µ–Ω—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Rails —Å–¥–µ–ª–∞–µ—Ç `.call(order)`, –∏ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç `return`, –∫–∞–∫ —Ç—ã –æ–∂–∏–¥–∞–µ—à—å.
  validate on: :create, &->(order) {
    return true  # –ò —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç lambda, –∞ –Ω–µ –≤—ã–±—Ä–æ—Å–∏—Ç LocalJumpError.
  }
end
```
