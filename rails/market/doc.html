Pt.products.first.c1.name
Pt.products.first.pricelists.where(:angar_id => 36).first.amount
SALE_STATISTIC['36'][Pt.products.first.articul]

Pt.products.first.quantity 36

Создание констант

CreateSaleStatisticConstant.new.process!
CreateTraderConstant.new.process!
MetricConstantCreate.new.process!
CreateStrictColorConstant.new.process!

select
  am.product,
  -- am.angar,
  an.name as Филиал,
  -- am.storehouse_articul,
  sh.name as Склад,
  case
    when sdsh.subdivision_sid is null then '-'
    else 'Да'
  end as 'Техниковский склад?',
  am.amount
from temp_amounts am
left join market_angars an on an.id = am.angar
left join market_storehouses sh on sh.articul = am.storehouse_articul
left join market_subdivisions_storehouses sdsh on sdsh.storehouse_uid = sh.uid
where
  am.product = 45415


<h2>Наличие</h2>
<p><strong>Обновить зависимости наличий:</strong></p>
<ul>
  <li><code>rails import:amountrule</code></li>
  <li><code>rails create:is_amountrule</code></li>
</ul>
<p><code>rails import:amountrule create:is_amountrule</code></p>
<h2>Обмен с 1С</h2>
<ul>
  <li>Класс: <code class="copyToClipboard">app/logic/concern/scopes/obmen.rb</code></li>
  <li>с настройками в файле <code class="copyToClipboard">app/logic/concern/scopes/obmen/config.rb</code></li>
  <li>основные методы в файле <code class="copyToClipboard">app/logic/concern/scopes/obmen/methods.rb</code></li>
</ul>

<h2>nicks</h2>
<ul>
  <li><i class="copyToClipboard">config/initializers/_app_nicks.rb</i></li>
  <li><i class="copyToClipboard">framework/_/nicks/=domain/=market.rb</i></li>
</ul>

<h2>Обновление</h2>

ssh market
cd app/tasker
git pull origin master
bundle

Копирование бд-ых в таскер
cp ../market/db/production.sqlite3 ./db/production.sqlite3
cp ../market/db/development.sqlite3 ./db/development.sqlite3

Миграция бд-продакшн:
TASKER=1 RAILS_ENV=production rails db:migrate

Импорт:
TASKER=1 RAILS_ENV=production rails import:all

Трейдерные данные:
TASKER=1 RAILS_ENV=production rails pricelist:all

Дополнительные данные и константы:
TASKER=1 RAILS_ENV=production rails create:all

Константа CAT:
RELOAD_CAT=1 rails c -e production

cp ../market/db/production.sqlite3 ../market/db/production-.sqlite3
cp ../market/db/development.sqlite3 ../market/db/development-.sqlite3

cp ./db/production.sqlite3 ../market/db/production.sqlite3
cp ./db/development.sqlite3 ../market/db/development.sqlite3

cp ./config/cache/*.{json,dump} ../market/config/cache/
cp ../market/config/cache/CAT_production.dump ../market/config/cache/CAT_development.dump

cd ../market/

git pull origin master

./bash/production/prepare.sh

screen -r ma
пока что вручную

